<ngx-spinner type="ball-scale-multiple"></ngx-spinner>
<p-toast></p-toast>

<div class="card card-flush" *ngIf="state$ | async">
    <p-toolbar>
        <!--begin::Card title-->
        <ng-template pTemplate="left" class="card-title">&nbsp;</ng-template>
        <!--end::Card title-->
        <!--begin::Card toolbar-->
        <ng-template pTemplate="right" class="card-toolbar">
            <div
                class="d-flex justify-content-end align-items-center"
                [style.display]="selectedDatas.length === 0 ? 'none !important' : 'flex'">
                <div class="fw-bold me-5">
                    <span class="me-2">{{ selectedDatas.length }}</span
                    >Selected
                </div>
                <button type="button" class="btn btn-danger" (click)="deleteMoreWithConfirm()">Delete Selected</button>
            </div>
            <div
                class="d-flex justify-content-end align-items-center"
                [style.display]="selectedDatas.length > 0 ? 'none !important' : 'flex'">
                <button type="button" class="btn btn-light-primary me-3" (click)="exportExcel()">
                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr078.svg-->
                    <span class="svg-icon svg-icon-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect
                                opacity="0.3"
                                x="12.75"
                                y="4.25"
                                width="12"
                                height="2"
                                rx="1"
                                transform="rotate(90 12.75 4.25)"
                                fill="currentColor"></rect>
                            <path
                                d="M12.0573 6.11875L13.5203 7.87435C13.9121 8.34457 14.6232 8.37683 15.056 7.94401C15.4457 7.5543 15.4641 6.92836 15.0979 6.51643L12.4974 3.59084C12.0996 3.14332 11.4004 3.14332 11.0026 3.59084L8.40206 6.51643C8.0359 6.92836 8.0543 7.5543 8.44401 7.94401C8.87683 8.37683 9.58785 8.34458 9.9797 7.87435L11.4427 6.11875C11.6026 5.92684 11.8974 5.92684 12.0573 6.11875Z"
                                fill="currentColor"></path>
                            <path
                                opacity="0.3"
                                d="M18.75 8.25H17.75C17.1977 8.25 16.75 8.69772 16.75 9.25C16.75 9.80228 17.1977 10.25 17.75 10.25C18.3023 10.25 18.75 10.6977 18.75 11.25V18.25C18.75 18.8023 18.3023 19.25 17.75 19.25H5.75C5.19772 19.25 4.75 18.8023 4.75 18.25V11.25C4.75 10.6977 5.19771 10.25 5.75 10.25C6.30229 10.25 6.75 9.80228 6.75 9.25C6.75 8.69772 6.30229 8.25 5.75 8.25H4.75C3.64543 8.25 2.75 9.14543 2.75 10.25V19.25C2.75 20.3546 3.64543 21.25 4.75 21.25H18.75C19.8546 21.25 20.75 20.3546 20.75 19.25V10.25C20.75 9.14543 19.8546 8.25 18.75 8.25Z"
                                fill="currentColor"></path>
                        </svg>
                    </span>
                    <!--end::Svg Icon-->Export Excel
                </button>
                <!--begin::Button-->
                <button pButton class="btn btn-primary" (click)="addData()">
                    <!--begin::Svg Icon | path: icons/duotune/general/gen035.svg-->
                    <span class="svg-icon svg-icon-3">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="5" fill="currentColor" />
                            <rect
                                x="10.8891"
                                y="17.8033"
                                width="12"
                                height="2"
                                rx="1"
                                transform="rotate(-90 10.8891 17.8033)"
                                fill="currentColor" />
                            <rect x="6.01041" y="10.9247" width="12" height="2" rx="1" fill="currentColor" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->Add Params
                </button>
                <!--end::Button-->
            </div>
        </ng-template>
        <!--end::Card toolbar-->
    </p-toolbar>
    <p-table
        #dt
        [columns]="cols"
        [value]="datas"
        [lazy]="true"
        (onLazyLoad)="loadDatas($event)"
        [paginator]="true"
        [totalRecords]="totalRecords"
        [showCurrentPageReport]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 20, 50]"
        sortField="-id"
        dataKey="id"
        [filterDelay]="1000"
        responsiveLayout="scroll"
        [(selection)]="selectedDatas"
        [selectionPageOnly]="true"
        csvSeparator=","
        exportFilename="params_export"
        [rowHover]="true"
        styleClass="card-body pt-0"
        tableStyleClass="table align-middle table-row-dashed fs-6 gy-5 mb-0">
        <ng-template pTemplate="header" let-columns>
            <tr class="text-start text-gray-400 fw-bold text-uppercase fs-7 gs-0">
                <th class="min-w-125px">
                    Variable Code
                    <p-columnFilter
                        type="text"
                        field="code"
                        display="menu"
                        matchMode="contains"
                        [showMatchModes]="true"
                        [matchModeOptions]="matchModeOptions"
                        [showOperator]="false"
                        [showAddButton]="false"
                        class="p-ml-auto"></p-columnFilter>
                </th>
                <th class="min-w-125px">Variable Name</th>
                <th class="min-w-125px">Is Calculated?</th>
                <th class="min-w-125px">Is Visible?</th>
                <th class="min-w-125px">Is Basic?</th>
                <th class="min-w-125px">Is Geophysic?</th>
                <th class="text-end min-w-100px">Action</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-data>
            <tr>
                <td>
                    {{ data.code }}
                </td>
                <td>
                    {{ data.name?.en }}
                </td>
                <td>
                    {{ data.is_calculated }}
                </td>
                <td>
                    {{ data.is_visible }}
                </td>
                <td>
                    {{ data.is_basic }}
                </td>
                <td>
                    {{ data.is_geophysic }}
                </td>
                <td class="text-end">
                    <button
                        class="btn btn-icon btn-active-light-primary w-30px h-30px me-3"
                        pTooltip="Edit"
                        tooltipPosition="left"
                        (click)="editData(data)">
                        <span
                            [inlineSVG]="'./assets/media/icons/duotune/art/art005.svg'"
                            class="svg-icon svg-icon-3"></span>
                    </button>
                    <button
                        class="btn btn-icon btn-active-light-primary w-30px h-30px"
                        pTooltip="Delete"
                        tooltipPosition="left"
                        (click)="deleteWithConfirm(data)">
                        <span class="svg-icon svg-icon-3">
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M5 9C5 8.44772 5.44772 8 6 8H18C18.5523 8 19 8.44772 19 9V18C19 19.6569 17.6569 21 16 21H8C6.34315 21 5 19.6569 5 18V9Z"
                                    fill="currentColor" />
                                <path
                                    opacity="0.5"
                                    d="M5 5C5 4.44772 5.44772 4 6 4H18C18.5523 4 19 4.44772 19 5V5C19 5.55228 18.5523 6 18 6H6C5.44772 6 5 5.55228 5 5V5Z"
                                    fill="currentColor" />
                                <path
                                    opacity="0.5"
                                    d="M9 4C9 3.44772 9.44772 3 10 3H14C14.5523 3 15 3.44772 15 4V4H9V4Z"
                                    fill="currentColor" />
                            </svg>
                        </span>
                    </button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<form [formGroup]="dataForm" (ngSubmit)="save()">
    <p-dialog
        [(visible)]="dialogForm"
        [breakpoints]="{ '960px': '75vw', '640px': '100vw' }"
        [style]="{ width: '50vw' }"
        [modal]="true">
        <ng-template pTemplate="header"> Param Details </ng-template>
        <input pInputText formControlName="id" hidden />
        <input pInputText formControlName="classname" hidden />
        <input pInputText formControlName="column_name" hidden />
        <input pInputText formControlName="module" hidden />
        <div class="card-body p-3">
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label required fw-bold fs-6">Variable Code</label>
                <div class="col-lg-8 fv-row">
                    <input
                        pInputText
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Variable Code"
                        formControlName="variable_code" />
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">Variable Name</label>
                <div class="col-lg-8 fv-row">
                    <label class="col-lg-4 col-form-label required fw-bold fs-6">EN</label>
                    <input
                        pInputText
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Variable Name"
                        formControlName="variable_name_en" />
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">&nbsp;</label>
                <div class="col-lg-8 fv-row">
                    <label class="col-lg-4 col-form-label fw-bold fs-6">ID</label>
                    <input
                        pInputText
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Variable Name"
                        formControlName="variable_name_id" />
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">Variable Tooltips</label>
                <div class="col-lg-8 fv-row">
                    <label class="col-lg-4 col-form-label required fw-bold fs-6">EN</label>
                    <input
                        pInputText
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Variable Tooltips"
                        formControlName="variable_tooltip_en" />
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">&nbsp;</label>
                <div class="col-lg-8 fv-row">
                    <label class="col-lg-4 col-form-label fw-bold fs-6">ID</label>
                    <input
                        pInputText
                        type="text"
                        class="form-control form-control-lg"
                        placeholder="Variable Tooltips"
                        formControlName="variable_tooltip_id" />
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">Is Caculated?</label>
                <div class="col-lg-8 fv-row">
                    <p-inputSwitch formControlName="is_calculated"></p-inputSwitch>
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">Is Visible?</label>
                <div class="col-lg-8 fv-row">
                    <p-inputSwitch formControlName="is_visible"></p-inputSwitch>
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">Is Basic?</label>
                <div class="col-lg-8 fv-row">
                    <p-inputSwitch formControlName="is_basic"></p-inputSwitch>
                </div>
            </div>
            <div class="row mb-6">
                <label class="col-lg-4 col-form-label fw-bold fs-6">Is Geophysics?</label>
                <div class="col-lg-8 fv-row">
                    <p-inputSwitch formControlName="is_geophysic"></p-inputSwitch>
                </div>
            </div>
        </div>
        <ng-template pTemplate="footer">
            <button
                type="submit"
                pButton
                pRipple
                icon="pi pi-save"
                class="btn btn-sm btn-primary"
                class="btn btn-primary"
                [disabled]="!dataForm.valid">
                Save
            </button>
        </ng-template>
    </p-dialog>
</form>

<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
